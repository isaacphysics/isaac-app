<div class="small-16 columns">
    <h1>Isaac Administration</h1>
</div>

<div class="row">
    <div class="small-16 columns">
        <div class="panel white clearfix">
            <h2>Useful links</h4>
            <ul class="no-bullet horizontal-list">
                <li><a ui-sref="contentErrors">Content Errors Page</a></li>
                <li><a href="/api/content/tags" target="_blank">List of tags</a></li>
                <li><a href="/api/content/units" target="_blank">List of units</a></li>
                <li><a ui-sref='adminStats'>More stats</a></li>
            </ul>            
        </div>
    </div>
</div>
<div class="row">
    <div class="small-16 columns">
        <div class="panel white clearfix">
            <div class="small-16 columns">
                <h2>Statistics at a glance</h2>
            </div>
            <div class="small-16 columns">
                <div class="text-center" ng-if="statsLoading">
                    <img src="/assets/loading.gif">
                </div>    
            </div>
            <div ng-if="!statsLoading">
                <div class="medium-8 small-16 columns">
                    <ul>
                        <li>
                            <strong>Users (Total Registered: {{statistics.totalUsers}})</strong>
                            <ul>
                                <li>
                                    <strong>Gender</strong>
                                    <ul>
                                        <li>Male: {{statistics.maleUsers}}</li>
                                        <li>Female: {{statistics.femaleUsers}}</li>
                                        <li>Unknown: {{statistics.unknownGenderUsers}}</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Role</strong>
                                    <ul>
                                        <li>Student (unknown role): {{statistics.studentUsers}}</li>
                                        <li>Teacher: {{statistics.teacherUsers}}</li>
                                        <li>Staff: {{statistics.staffUsers}}</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>Profile Completion</strong>
                                    <ul>
                                        <li>School provided: {{statistics.hasSchool}} ({{statistics.hasSchoolOther}} - from 'school other')</li>
                                        <li>No School Information: {{statistics.hasNoSchool}}</li>
                                    </ul>
                                </li> 
                                <li>
                                    <strong>Last Seen Data (non-staff)</strong>
                                    <ul>
                                        <li>Last 7 days: {{statistics.activeUsersLastWeek}} (Teachers: {{statistics.activeTeachersLastWeek}}, Students: {{statistics.activeStudentsLastWeek}})</li>
                                        <li>Last 30 days: {{statistics.activeUsersLastThirtyDays}} (Teachers: {{statistics.activeTeachersLastThirtyDays}}, Students: {{statistics.activeStudentsLastThirtyDays}})</li>
                                    </ul>
                                </li>                                                            
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="medium-8 small-16 columns">
                    <ul>
                        <li>
                            <strong>Events</strong>
                            <ul>
                                <li>Viewed Questions Events: {{statistics.viewQuestionEvents}}</li>
                                <li># of Questions Answered Events ({{statistics.answeredQuestionEvents}}): <ul>
                                    <li>Last 7 days: Teachers: {{statistics.questionsAnsweredLastWeekTeachers}}, Students: {{statistics.questionsAnsweredLastWeekStudents}}</li>
                                    <li>Last 30 days: Teachers: {{statistics.questionsAnsweredLastThirtyDaysTeachers}}, Students: {{statistics.questionsAnsweredLastThirtyDaysStudents}}</li>                    
                                </ul></li>
                            </ul>
                        </li> 
                    </ul>
                </div>                
            </div>
        </div>        
    </div>
</div>

<div ng-show="isAdminUser">
    <div class="row">
        <div class="small-16 columns">
            <div class="panel white clearfix">
                <div class="row">
                    <div class="small-16 columns">
                        <h2>Administrative tools</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="small-16 columns">
                       <h3>Manage site content <a name="content">&nbsp;</a></h3>
                    </div>
                    <div class="medium-5 columns text-right">
                       <label for="content-version">
                            <strong>Live Content Version</strong>
                        </label>
                    </div>
                    <form ng-submit="setVersion()">
                        <div class="medium-7 columns end">
                            <input id="content-version" type="text" ng-model="contentVersion.liveVersion" placeholder="Enter commit SHA" ng-change="versionChange = null">
                        </div>
                        <div class="medium-4 columns end" ng-if="versionChange != 'IN_PROGRESS'">
                            <button ng-click="setVersion()">Set Version</button>
                        </div>
                    </form>
                </div>
                <div class="row" ng-if="versionChange == 'IN_PROGRESS'">
                    <div class="medium-16 columns text-center">
                        <h4>Updating...</h4>
                        <img src="/assets/loading.gif">
                    </div>
                </div>
                <div class="row" ng-if="versionChange == 'SUCCESS'">
                    <div class="medium-16 columns text-center">
                        <h4>Content version changed successfully.</h4>
                    </div>
                </div>
                <div class="row" ng-if="versionChange == 'ERROR'">
                    <div class="medium-16 columns text-center">
                        <h4 style="color:#a00;">Error: Content version could not be changed.</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="small-16 columns">
                       <h3>Manage user accounts <a name="users">&nbsp;</a></h3>
                    </div>
                    <form ng-submit="findUsers()">
                        <div class="medium-12 medium-centered columns end">
                            <label for="user-search-familyName">
                                <strong>Find a user by family name</strong>
                            </label>                            
                            <input id="user-search-familyName" type="text" ng-model="userSearch.searchTerms.familyName" placeholder="Enter user familyName" >
                            <label for="user-search-email">
                                <strong>Find a user by email</strong>
                            </label>                            
                            <input id="user-search-email" type="text" ng-model="userSearch.searchTerms.email" placeholder="Enter user email" >
                            <label for="user-search-role">
                                <strong>Find by user role:</strong>
                            </label>
                            <select id="user-search-role" ng-model="userSearch.searchTerms.role">
                                <option value="">Any Role</option>
                                <option value="TEACHER">Teacher</option>
                                <option value="CONTENT_EDITOR">Content Editor</option>
                                <option value="ADMIN">Admin</option>
                            </select>                            
                        </div>
                        <div class="medium-12 medium-centered columns end">
                            <button ng-click="findUsers()">Find user</button>
                        </div>        
                    </form>
                </div>
            
                <!-- Results TODO: stolen from search page this needs tidying up -->
                <section ng-if="userSearch.hasSearched">
                    <div class="small-16 columns" ng-if="userSearch.isLoading">
                            <h4>User search results</h4>                        
                        <div class="text-center" >
                            <img src="/assets/loading.gif">
                        </div>    
                    </div>

                    <div class="row" ng-if="userSearch.results && !userSearch.isLoading">
                        <div class="small-16 columns">
                            <h4>User search results ({{userSearch.results.length}})</h4>
                            <div class="ru-concept-results">
                                <div ng-repeat="result in userSearch.results" class='row ru-mobile-answer-wrap' class="physics">
                                    <div class='small-16 columns'>
                                        <div ng-class="{'ru-search-result': true, odd: $odd, even: $even}">
                                            <div ui-sref="accountSettings({'userId' : result._id })" class="ru-search-result-content">
                                                <img class="right show-for-small-only" src="/assets/isaac-index-arrow.png">
                                                <h4>
                                                    <span class="physics">{{result.familyName}}, {{result.givenName}}, {{result.email}}</span> 
                                                    <br> Role: {{result.role || "NOT_SET"}} 
                                                    <br> School Set: {{result.schoolId != null ? 'Yes (UK)' : result.schoolOther != null ? 'Yes (Other)' : 'None Set' }} 
                                                    <br> Member Since: {{result.registrationDate | date:'dd/MM/yyyy'}} Last Seen: {{result.lastSeen | date:'dd/MM/yyyy'}}
                                                </h4>
                                            </div>
                                            <a href="javascript:void(0);" class="right" ng-click="deleteUser(result._id)">Delete user</a>
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

